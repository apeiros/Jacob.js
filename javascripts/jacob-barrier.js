
if(!window.Jacob)window.Jacob={};Jacob=window.Jacob;(function(){Jacob.Barrier=function Jacob__Barrier(){this.length=0;this._waiterID=0;this._waiters={};this._releasers=[];};Jacob.Barrier.prototype.wait=function Jacob__Barrier___wait(id){var barrier=this;var id=this.block(id);var waiter=function(){barrier.clear(id)};return waiter;};Jacob.Barrier.prototype.block=function Jacob__Barrier___block(id){var id=id||this.nextID();if(!this._waiters[id]){this.length++;this._waiters[id]=true;}
return id;};Jacob.Barrier.prototype.nextID=function Jacob__Barrier___nextID(){var id=this._waiterID;this._waiterID++;return id;};Jacob.Barrier.prototype.clear=function Jacob__Barrier___clear(id){if(this._waiters[id]){this.length--;delete this._waiters[id];if(!this.length)this.triggerRelease();}
return this;};Jacob.Barrier.prototype.triggerRelease=function Jacob__Barrier___triggerRelease(){for(var i=0;i<this._releasers.length;i++)this._releasers[i]();return this;};Jacob.Barrier.prototype.release=function Jacob__Barrier___release(releaser){this._releasers.push(releaser);return this;};})();